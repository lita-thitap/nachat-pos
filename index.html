<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nachat POS</title>
  <!-- favicon ใช้โลโก้ใน repo -->
  <link rel="icon" type="image/png" href="nachatlogo.png" />
  <style>
    :root{
      --bg:#111; --bg2:#1e1e1e; --panel:#fff; --raised:#fafafa; --line:#e9e9e9;
      --black:#111; --muted:#707070; --brand:#111;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--black);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto}

    header{background:linear-gradient(#1c1c1c,#1a1a1a);color:#fff;border-bottom:1px solid #000}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    .head-row{display:flex;align-items:center;gap:12px;justify-content:center}
    .header-logo{height:56px;width:56px;object-fit:contain;border-radius:8px}
    h1{margin:0;font-size:24px;font-weight:800}
    .sub{margin-top:6px;text-align:center;color:#d5d5d5}

    .tabs{display:flex;gap:8px;flex-wrap:wrap;max-width:1200px;margin:16px auto 0;padding:0 16px}
    .tab{padding:10px 14px;border:1.5px solid var(--black);border-radius:12px;background:#fff;cursor:pointer}
    .tab.active{outline:2px solid var(--black);background:var(--raised)}
    .content{max-width:1200px;margin:12px auto;padding:0 16px 32px}

    .card{background:#fff;border:1px solid var(--line);border-radius:16px;padding:12px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
    .row{display:flex;gap:10px;align-items:center}
    .row > *{flex:1}
    .right{display:flex;justify-content:flex-end}
    .muted{color:var(--muted)}

    .btn{padding:9px 12px;border-radius:12px;border:1.5px solid var(--black);background:#fff;color:#111;cursor:pointer}
    .btn.primary{background:#111;color:#fff}
    .btn.ghost{background:transparent}
    input,select{background:#fff;border:1.5px solid var(--black);color:#111;padding:9px 10px;border-radius:12px;width:100%}
    .pill{padding:6px 10px;border-radius:999px;border:1.5px solid var(--black);background:#fff;color:#111}

    .menu-column .item{background:#111;color:#fff;border-radius:14px;padding:10px 12px;border:1px solid #000;cursor:pointer}
    .menu-column .item .price{display:inline-block;margin-left:10px;padding:2px 8px;border-radius:999px;background:#fff;color:#111;border:1px solid #111}

    .bill-row{display:grid;grid-template-columns:1fr 220px 220px 180px;gap:10px;align-items:center}

    .report-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .report-cards{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .kpi{background:#fff;border:1px solid var(--line);border-radius:16px;padding:12px}
    .kpi h2{margin:0 0 6px 0;font-size:18px}
    .kpi .big{font-size:34px;font-weight:800}
    .top-list li{display:flex;justify-content:space-between;border-bottom:1px dashed var(--line);padding:6px 0}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 8px;border-bottom:1px solid var(--line);text-align:left}

    dialog{border:none;border-radius:16px;max-width:520px;width:96%}
    dialog::backdrop{background:rgba(0,0,0,.35)}
  </style>
</head>
<body>

  <header>
    <div class="wrap">
      <div class="head-row">
        <img src="nachatlogo.png" alt="Nachat Logo" class="header-logo" />
        <h1>ณฉัตร | Nachat – POS</h1>
      </div>
      <div class="sub">หมูกระทะชุดละ 299 + Add-on & เครื่องดื่ม | สรุปยอดขายรายวัน / สัปดาห์ / เดือน</div>
    </div>
  </header>

  <div class="tabs">
    <button class="tab active" data-tab="#pos">รับออเดอร์</button>
    <button class="tab" data-tab="#open">โต๊ะ/บิล</button>
    <button class="tab" data-tab="#reports">รายงานขาย</button>
    <button class="tab" data-tab="#settings">ตั้งค่าร้าน</button>
  </div>

  <div class="content">
    <!-- POS -->
    <section id="pos" class="tabpane">
      <div class="card">
        <div class="row">
          <div><label class="muted">โต๊ะ</label><input id="inpTable" placeholder="เช่น N1" /></div>
          <div><label class="muted">พนักงาน</label><input id="inpStaff" placeholder="เช่น Koch" /></div>
          <div style="max-width:160px;align-self:end"><button id="btnOpenBill" class="btn primary">เปิดบิล</button></div>
        </div>
      </div>

      <div style="height:8px"></div>
      <div id="menuPanels" class="grid"></div>

      <div style="height:8px"></div>
      <div class="card">
        <h3>ตะกร้า</h3>
        <div id="cartList" class="muted">ยังไม่มีรายการ</div>
        <div class="row" style="margin-top:8px">
          <div class="pill">รวม: <b id="cartTotal">0</b> บาท</div>
          <div class="right" style="flex:1;gap:8px">
            <button id="btnClearCart" class="btn ghost">ล้างตะกร้า</button>
            <button id="btnAddToBill" class="btn primary">เพิ่มลงบิลปัจจุบัน</button>
          </div>
        </div>
      </div>
    </section>

    <!-- OPEN BILLS -->
    <section id="open" class="tabpane" hidden>
      <div class="card">
        <h3>บิลที่เปิดอยู่</h3>
        <div id="openBills" style="display:grid;gap:10px"></div>
      </div>
    </section>

    <!-- REPORTS -->
    <section id="reports" class="tabpane" hidden>
      <div class="card">
        <div class="row" style="gap:8px;align-items:end">
          <div>
            <label class="muted">ช่วง</label>
            <select id="selPreset">
              <option value="month">เดือนนี้</option>
              <option value="today">วันนี้</option>
              <option value="7d">7 วันล่าสุด</option>
              <option value="custom">กำหนดเอง</option>
            </select>
          </div>
          <div><label class="muted">จาก</label><input type="date" id="dFrom"></div>
          <div><label class="muted">ถึง</label><input type="date" id="dTo"></div>
          <div class="right"><button id="btnExportCsv" class="btn">Export CSV</button></div>
        </div>

        <div style="height:10px"></div>

        <div class="row" style="gap:10px; align-items:center">
          <div><b>Google Sheets Sync</b><div class="muted">Web App URL (Apps Script)</div></div>
          <input id="inpWebAppUrl" placeholder="https://script.google.com/macros/s/…/exec" />
          <select id="selSyncMode" style="max-width:220px">
            <option value="auto">Auto: ปิดบิลแล้วซิงก์เลย</option>
            <option value="manual">Manual: ซิงก์เอง</option>
          </select>
          <button id="btnSaveUrl" class="btn">บันทึกการตั้งค่า</button>
          <button id="btnTest" class="btn">ทดสอบเชื่อมต่อ</button>
          <button id="btnPushPending" class="btn primary">ซิงก์ที่ค้างส่ง</button>
        </div>
        <div id="gsStatus" class="muted" style="margin-top:6px"></div>
      </div>

      <div style="height:10px"></div>

      <div class="report-grid">
        <div class="report-cards">
          <div class="kpi">
            <h2>ยอดขายรวม</h2>
            <div class="big" id="kpiSum">฿0</div>
            <div class="muted">บิลเฉลี่ย: <span id="kpiAvg">฿0</span></div>
          </div>
          <div class="kpi">
            <h2>จำนวนบิล</h2>
            <div class="big" id="kpiBills">0</div>
            <div class="muted">ช่วงที่เลือก</div>
          </div>
        </div>

        <div class="card">
          <h3>Top สินค้าขายดี</h3>
          <ul id="topList" class="top-list" style="list-style:none;padding:0;margin:0"></ul>
        </div>
      </div>

      <div style="height:10px"></div>

      <div class="card">
        <h3>รายการบิล</h3>
        <div id="salesTableBox">ยังไม่มีข้อมูล</div>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="settings" class="tabpane" hidden>
      <div class="card">
        <h3>ตั้งค่าเมนู (จัดตามหมวด)</h3>
        <div class="row" style="gap:8px;margin-bottom:8px">
          <input id="newName" placeholder="ชื่อเมนูใหม่เร็วๆ" />
          <input id="newPrice" type="number" placeholder="ราคา" style="max-width:140px" />
          <select id="newCat" style="max-width:220px">
            <option value="SET">ชุดหมูกระทะ</option>
            <option value="AD">Add-on</option>
            <option value="DW">เครื่องดื่ม</option>
            <option value="PR">โปรเครื่องดื่ม</option>
          </select>
          <input id="newCode" placeholder="รหัส (เช่น Z99)" style="max-width:140px" />
          <button id="btnAddMenu" class="btn primary">เพิ่ม</button>
        </div>
        <div id="menuTableBox" class="muted">ยังไม่มีเมนู — เพิ่มด้านบนได้เลย</div>
      </div>
    </section>
  </div>

  <!-- Pay modal -->
  <dialog id="payModal">
    <form method="dialog" class="card" style="border:none">
      <h3>ปิดบิล</h3>
      <div class="row">
        <div><label class="muted">โต๊ะ</label><input id="payTable" readonly /></div>
        <div><label class="muted">พนักงาน</label><input id="payStaff" readonly /></div>
      </div>
      <div style="height:6px"></div>
      <div><label class="muted">ยอดรวมทั้งหมด</label><input id="payTotal" readonly /></div>
      <div style="height:6px"></div>
      <div class="row">
        <div style="flex:1">
          <label class="muted">วิธีชำระเงิน</label>
          <select id="payMethod" style="width:100%">
            <option value="cash">เงินสด</option>
            <option value="scan">โอน/สแกน</option>
          </select>
        </div>
        <div style="flex:1">
          <label class="muted">รับเงิน</label>
          <input id="payReceived" type="number" placeholder="รับเงินมา (บาท)" />
        </div>
        <div style="flex:1">
          <label class="muted">เงินทอน</label>
          <input id="payChange" readonly placeholder="฿0" />
        </div>
      </div>

      <div id="qrBox" class="row" style="margin-top:6px" hidden>
        <img id="qrImg" alt="QR" style="
    width: 160px;
    height: 200px;
    object-fit: contain;
    border-radius: 10px;
    border: 1px solid #ddd;
    background: #fff;
  "
/>
        <div id="qrNote" class="muted" style="margin-left:10px"></div>
      </div>

      <div class="right" style="gap:8px;margin-top:10px">
        <button class="btn" value="cancel">ยกเลิก</button>
        <button id="btnConfirmPay" class="btn primary" value="ok">ปิดบิล</button>
      </div>
    </form>
  </dialog>

  <script>
    // Tabs
    document.querySelectorAll('.tab').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.tabpane').forEach(p=>p.hidden=true);
        document.querySelector(btn.dataset.tab).hidden=false;
      });
    });
  </script>

  <script src="app.js"></script>
  <script src="sync.js"></script>
</body>
</html>
